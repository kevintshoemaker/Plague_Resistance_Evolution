"INITFREQ",
"DOMINANCE"
)
#name check
cbind(pred.names,predictorNames)
#### Define response variable
response="ISRES"
formula1 <- as.formula(paste(response,"~",paste(pred.names,collapse="+")))
formula1
setwd(dirs$GIT_DIR)
source("E:\\GIT\\Random-Forest-Functions\\RF_Extensions.R")   # change to your script locations
dirs$GIT_DIR
source("C:\\Users\\Kevin\\GIT\\Random-Forest-Functions\\RF_Extensions.R")   # change to your script locations
install.packages(pkg)
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.99,maxdepth = 3))
source("C:\\Users\\Kevin\\GIT\\Random-Forest-Functions\\RF_Extensions.R")   # change to your script locations
install.packages(pkg)
loadPackage <- function(pkg){
if(pkg %in% rownames(installed.packages()) == FALSE) {suppressMessages(suppressWarnings(install.packages(pkg)))}
eval(parse(text=sprintf("suppressMessages(suppressWarnings(require(%s)))",pkg)), envir= .GlobalEnv)
}
loadPackage("party")
loadPackage("rms")
loadPackage("ROCR")
loadPackage("RColorBrewer")
install.packages(pkg)
install.packages("RColorBrewer")
install.packages("RColorBrewer")
source("C:\\Users\\Kevin\\GIT\\Random-Forest-Functions\\RF_Extensions.R")   # change to your script locations
install.packages(pkg)
loadPackage("party")
loadPackage("rms")
loadPackage("ROCR")
loadPackage("RColorBrewer")
install.packages("ROCR")
loadPackage("party")
loadPackage("rms")
loadPackage("ROCR")
loadPackage("RColorBrewer")
install.packages("rms")
install.packages("rms")
source("C:\\Users\\Kevin\\GIT\\Random-Forest-Functions\\RF_Extensions.R")   # change to your script locations
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.99,maxdepth = 3))
df <- masterDF2
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.99,maxdepth = 3))
plot(TerrMamm.tr)
plot(res.tr)
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.7,maxdepth = 3))
plot(res.tr)
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.5,maxdepth = 3))
plot(res.tr)
summary(res.tr)
cforestControl <- cforest_unbiased(ntree=100,mtry=5)   # change back to 500!!
cforestControl@fraction <- 0.75
cforestControl
cforestControl@gtctrl@mincriterion <- 0.6
rf_model1 <- cforest(formula1, controls=cforestControl, data=df)
model1_importance<-varimp((rf_model1), conditional= FALSE)
graphics.off()
lengthndx <- length(model1_importance)
#par(mai=c(0.95,3.1,0.6,0.4))
par(mai=c(1.4,3.4,0.6,0.9))
col <- rainbow(lengthndx, start = 3/6, end = 4/6)      # rep(brewer.pal(6,"Blues"),each=2)
barplot(height=model1_importance[order(model1_importance,decreasing = FALSE)],
horiz=T,las=1,main="Order of Importance of Predictor Variables",
xlab="Index of overall importance",col=col,
names.arg=predictorNames[match(names(model1_importance),pred.names)][order(model1_importance,decreasing = FALSE)])
cforestControl <- cforest_unbiased(ntree=500,mtry=5)   # change back to 500!!
cforestControl@fraction <- 0.75
cforestControl@gtctrl@mincriterion <- 0.6
rf_model1 <- cforest(formula1, controls=cforestControl, data=df)
# get the importance values
model1_importance<-varimp((rf_model1), conditional= FALSE)
graphics.off()
lengthndx <- length(model1_importance)
#par(mai=c(0.95,3.1,0.6,0.4))
par(mai=c(1.4,3.4,0.6,0.9))
col <- rainbow(lengthndx, start = 3/6, end = 4/6)      # rep(brewer.pal(6,"Blues"),each=2)
barplot(height=model1_importance[order(model1_importance,decreasing = FALSE)],
horiz=T,las=1,main="Order of Importance of Predictor Variables",
xlab="Index of overall importance",col=col,
names.arg=predictorNames[match(names(model1_importance),pred.names)][order(model1_importance,decreasing = FALSE)])
plot(res.tr)
predictorNames <- c(  "% Habitat",       # nice readable names
#"Conspecific attraction",
"Plague colony disruption",
"Maximum density per ha",
#"Plague survival, susceptible",
"Mean fecundity",
#"Fitness cost of resistance",
"Initial resistance allele freq."
#"Dominance of resistance factors"
)
pred.names=c(  "PER_SUITABLE",
#"SNUGGLE",
"PLAGUE_DISPERSAL",
"MAXDENS",
#"BASELINE_PLAGUESURV",
"BASELINE_MEANFEC",
#"FITNESS_COST",
"INITFREQ"
#"DOMINANCE"
)
#name check
cbind(pred.names,predictorNames)
#### Define response variable
response="ISRES"
#### Define our formula (response ~ predictors)
formula1 <- as.formula(paste(response,"~",paste(pred.names,collapse="+")))
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.5,maxdepth = 3))
plot(res.tr)
formula1
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.5,maxdepth = 3))
plot(res.tr)
summary(res.tr)
cforestControl <- cforest_unbiased(ntree=500,mtry=6)   # change back to 500!!
cforestControl@fraction <- 0.75
cforestControl@gtctrl@mincriterion <- 0.5
rf_model1 <- cforest(formula1, controls=cforestControl, data=df)
warnings()
cforestControl <- cforest_unbiased(ntree=500,mtry=3)   # change back to 500!!
cforestControl@fraction <- 0.75
cforestControl@gtctrl@mincriterion <- 0.5
rf_model1 <- cforest(formula1, controls=cforestControl, data=df)
model1_importance<-varimp((rf_model1), conditional= FALSE)
graphics.off()
lengthndx <- length(model1_importance)
#par(mai=c(0.95,3.1,0.6,0.4))
par(mai=c(1.4,3.4,0.6,0.9))
col <- rainbow(lengthndx, start = 3/6, end = 4/6)      # rep(brewer.pal(6,"Blues"),each=2)
barplot(height=model1_importance[order(model1_importance,decreasing = FALSE)],
horiz=T,las=1,main="Order of Importance of Predictor Variables",
xlab="Index of overall importance",col=col,
names.arg=predictorNames[match(names(model1_importance),pred.names)][order(model1_importance,decreasing = FALSE)])
masterDF2$ISRES <- as.factor(masterDF2$ISRES)
masterDF2$ISEXT <- as.factor(masterDF2$ISEXT)
masterDF2$DOMINANCE <- as.factor(masterDF2$DOMINANCE)
df <- masterDF2
############### NAMING VARIABLES ############
predictorNames <- c(  "% Habitat",       # nice readable names
"Conspecific attraction",
"Plague colony disruption",
"Maximum density per ha",
"Plague survival, susceptible",
"Mean fecundity",
"Fitness cost of resistance",
"Initial resistance allele freq.",
"Dominance of resistance factors"
)
pred.names=c(  "PER_SUITABLE",
"SNUGGLE",
"PLAGUE_DISPERSAL",
"MAXDENS",
"BASELINE_PLAGUESURV",
"BASELINE_MEANFEC",
"FITNESS_COST",
"INITFREQ",
"DOMINANCE"
)
#name check
cbind(pred.names,predictorNames)
#### Define response variable
response="ISRES"
#### Define our formula (response ~ predictors)
formula1 <- as.formula(paste(response,"~",paste(pred.names,collapse="+")))
res.tr <- ctree(formula=formula1, data=df, controls = ctree_control(mincriterion = 0.5,maxdepth = 3))
plot(res.tr)
summary(res.tr)
cforestControl <- cforest_unbiased(ntree=500,mtry=3)   # change back to 500!!
cforestControl@fraction <- 0.75
cforestControl@gtctrl@mincriterion <- 0.5
rf_model1 <- cforest(formula1, controls=cforestControl, data=df)
# get the importance values
model1_importance<-varimp((rf_model1), conditional= FALSE)
graphics.off()
lengthndx <- length(model1_importance)
#par(mai=c(0.95,3.1,0.6,0.4))
par(mai=c(1.4,3.4,0.6,0.9))
col <- rainbow(lengthndx, start = 3/6, end = 4/6)      # rep(brewer.pal(6,"Blues"),each=2)
barplot(height=model1_importance[order(model1_importance,decreasing = FALSE)],
horiz=T,las=1,main="Order of Importance of Predictor Variables",
xlab="Index of overall importance",col=col,
names.arg=predictorNames[match(names(model1_importance),pred.names)][order(model1_importance,decreasing = FALSE)])
plot(res.tr)
BETADENS <- 0.005
BETAPLAGUE <- 0.9
INTERACTION <- 0.03
INTERCEPT <- -6
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:5),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
faken
fakedens <- seq(0,200,length=faken)
fakedens
fakeplague <- rbinom(faken,1,fakeplagueprob)
fakeplague
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.005
BETAPLAGUE <- 0.5
INTERACTION <- 0.03
INTERCEPT <- -6
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.005
BETAPLAGUE <- 0.4
INTERACTION <- 0.05
INTERCEPT <- -8
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
# raster::plot(fakeplagueprob~fakeplaguepops)
#raster::plot(fakeplagueprob~fakedens)
fakeplague <- rbinom(faken,1,fakeplagueprob)
fakeplagueprob
BETADENS <- 0.005
BETAPLAGUE <- 0.4
INTERACTION <- 0.05
INTERCEPT <- -8
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.005
BETAPLAGUE <- 0.2
INTERACTION <- 0.07
INTERCEPT <- -8
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.005
BETAPLAGUE <- 0.15
INTERACTION <- 0.04
INTERCEPT <- -8
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
# raster::plot(fakeplagueprob~fakeplaguepops)
#raster::plot(fakeplagueprob~fakedens)
fakeplague <- rbinom(faken,1,fakeplagueprob)
dataFrame <- data.frame(plague=fakeplague,dens=fakedens,plaguepops=fakeplaguepops)
plaguemodel <- glm(plague~1+plaguepops*dens,data=dataFrame,family="binomial")
plaguemodel
fakeplagueprob
BETADENS <- 0.002
BETAPLAGUE <- 0.15
INTERACTION <- 0.04
INTERCEPT <- -8
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.003
BETAPLAGUE <- 0.15
INTERACTION <- 0.04
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.001
BETAPLAGUE <- 0.1
INTERACTION <- 0.09
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.0001
BETAPLAGUE <- 0.05
INTERACTION <- 0.08
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
# raster::plot(fakeplagueprob~fakeplaguepops)
#raster::plot(fakeplagueprob~fakedens)
fakeplague <- rbinom(faken,1,fakeplagueprob)
dataFrame <- data.frame(plague=fakeplague,dens=fakedens,plaguepops=fakeplaguepops)
plaguemodel <- glm(plague~1+plaguepops*dens,data=dataFrame,family="binomial")
fakeplagueprob
INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens
BETADENS <- 0.0001
BETAPLAGUE <- 0.05
INTERACTION <- 0.03
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.0005
BETAPLAGUE <- 0.05
INTERACTION <- 0.03
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
GetPlagueModel <- function(){
BETADENS <- 0.0005
BETAPLAGUE <- 0.05
INTERACTION <- 0.03
INTERCEPT <- -9
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
# raster::plot(fakeplagueprob~fakeplaguepops)
#raster::plot(fakeplagueprob~fakedens)
fakeplague <- rbinom(faken,1,fakeplagueprob)
dataFrame <- data.frame(plague=fakeplague,dens=fakedens,plaguepops=fakeplaguepops)
plaguemodel <- glm(plague~1+plaguepops*dens,data=dataFrame,family="binomial")
plogis(predict(plaguemodel,newdata=data.frame(dens=c(10:10),plaguepops=c(1:10))))
#summary(plaguemodel)
return(plaguemodel)
}
# 8/29/16: changed to consider a binary resistance trait that is potentially a function of several gene loci...
############
## CLEAR WORKSPACE
############
rm(list=ls())
############
## SIMULATION CONTROLS
############
NYEARS <- 50
100%%5
101%%5
120/5
# time step is one year
# consider scalar demographic model for now, but with potential for matrix model
# 8/29/16: changed to consider a binary resistance trait that is potentially a function of several gene loci...
############
## CLEAR WORKSPACE
############
rm(list=ls())
############
## SIMULATION CONTROLS
############
NYEARS <- 50
############
## SET GLOBAL VARS
############
KEVIN_LAPTOP <- TRUE #  FALSE #
KEVIN_OFFICEPC <- FALSE # TRUE #
if(KEVIN_LAPTOP) GIT_DIR <- "C:\\Users\\Kevin\\GIT\\Plague_Resistance_Evolution"
if(KEVIN_OFFICEPC) GIT_DIR <- "E:\\GIT\\Plague_Resistance_Evolution"
#####################
# LOAD FUNCTIONS
#####################
setwd(GIT_DIR)
source("PlagueResistanceEvolution_FUNCTIONS.R")
############
## SET UP WORKSPACE AND LOAD PACKAGES
############
dirs <- SetUpDirectories()
num_cores <- parallel::detectCores() - 1   # for setting up cluster... leave one core free for windows background processes?
############
## SAMPLE FROM LATIN HYPERCUBE
############
N_LHS_SAMPLES <- 120
masterDF <- MakeLHSSamples(nicheBreadthDir=dir,NicheBreadth)
###########
##  START A PARALLEL FOR LOOP
###########
library(parallel)
library(doParallel)
cl <- parallel::makeCluster(num_cores,outfile="LOG.TXT")
doParallel::registerDoParallel(cl=cl)    # make the cluster
#######################
## objects to export to each node in the cluster
# functionlist <- c()   # , 'mp.write'
# filelist <- c()  # 'masterDF', 'MP_DIRECTORY','template','GENTIME','humanArrival.df','EXE_DIRECTORY','DLL_FILENAME','dispersalFunc.df','DistClasses','NPOPS','DistBins',
#
# objectlist <- c(functionlist,filelist)   # full list of objects to export
#
#
# packagelist <- c("secr","igraph","raster")
allsamples <- foreach(i = 61: (60+nrow(masterDF))
# .export=objectlist,
# .packages = packagelist,
# .errorhandling=c("pass")
) %dopar% {
# #####################
# # LOAD FUNCTIONS
# #####################
#
# setwd(GIT_DIR)
# source("PlagueResistanceEvolution_FUNCTIONS.R")
#
############
## SET UP WORKSPACE AND LOAD PACKAGES
############
#SetUpWorkspace()
#num_cores <- detectCores() - 1   # for setting up cluster... leave one core free for windows background processes?
temp <- MakeWorker(NYEARS, masterDF, dirs)(i)  #DoSimulateResistance(rep=i)    # simulate for these params...
}     ## end parallel for loop
BETADENS <- 0.005  # 0.005
BETAPLAGUE <- 0.9  # 0.9
INTERACTION <- 0.03
INTERCEPT <- -6  # -6
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
BETADENS <- 0.001  # 0.005
BETAPLAGUE <- 0.9  # 0.9
INTERACTION <- 0.05  # 0.03
INTERCEPT <- -6  # -6
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:15),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
faken <- 1000
fakedens <- seq(0,200,length=faken)
fakeplaguepops <- sample(c(0:5),faken,replace=T)
fakeplagueprob <- plogis(INTERCEPT + BETADENS*fakedens + BETAPLAGUE*fakeplaguepops + INTERACTION*fakeplaguepops*fakedens)
fakeplagueprob
# time step is one year
# consider scalar demographic model for now, but with potential for matrix model
# 8/29/16: changed to consider a binary resistance trait that is potentially a function of several gene loci...
############
## CLEAR WORKSPACE
############
rm(list=ls())
############
## SIMULATION CONTROLS
############
NYEARS <- 50
############
## SET GLOBAL VARS
############
KEVIN_LAPTOP <- TRUE #  FALSE #
KEVIN_OFFICEPC <- FALSE # TRUE #
if(KEVIN_LAPTOP) GIT_DIR <- "C:\\Users\\Kevin\\GIT\\Plague_Resistance_Evolution"
if(KEVIN_OFFICEPC) GIT_DIR <- "E:\\GIT\\Plague_Resistance_Evolution"
#####################
# LOAD FUNCTIONS
#####################
setwd(GIT_DIR)
source("PlagueResistanceEvolution_FUNCTIONS.R")
############
## SET UP WORKSPACE AND LOAD PACKAGES
############
dirs <- SetUpDirectories()
num_cores <- parallel::detectCores() - 1   # for setting up cluster... leave one core free for windows background processes?
############
## SAMPLE FROM LATIN HYPERCUBE
############
N_LHS_SAMPLES <- 120
masterDF <- MakeLHSSamples(nicheBreadthDir=dir,NicheBreadth)
###########
##  START A PARALLEL FOR LOOP
###########
library(parallel)
library(doParallel)
cl <- parallel::makeCluster(num_cores,outfile="LOG.TXT")
doParallel::registerDoParallel(cl=cl)    # make the cluster
#######################
## objects to export to each node in the cluster
# functionlist <- c()   # , 'mp.write'
# filelist <- c()  # 'masterDF', 'MP_DIRECTORY','template','GENTIME','humanArrival.df','EXE_DIRECTORY','DLL_FILENAME','dispersalFunc.df','DistClasses','NPOPS','DistBins',
#
# objectlist <- c(functionlist,filelist)   # full list of objects to export
#
#
# packagelist <- c("secr","igraph","raster")
allsamples <- foreach(i = 61: (60+nrow(masterDF))
# .export=objectlist,
# .packages = packagelist,
# .errorhandling=c("pass")
) %dopar% {
# #####################
# # LOAD FUNCTIONS
# #####################
#
# setwd(GIT_DIR)
# source("PlagueResistanceEvolution_FUNCTIONS.R")
#
############
## SET UP WORKSPACE AND LOAD PACKAGES
############
#SetUpWorkspace()
#num_cores <- detectCores() - 1   # for setting up cluster... leave one core free for windows background processes?
temp <- MakeWorker(NYEARS, masterDF, dirs)(i)  #DoSimulateResistance(rep=i)    # simulate for these params...
}     ## end parallel for loop
#MakeWorker(NYEARS, masterDF, dirs)(1)
###################
# CLOSE CLUSTER
###################
if(!is.null(cl)) {
parallel::stopCluster(cl)
cl <- c()
}
